import styled from '@emotion/styled';
import { memo, useState } from 'react';
import { Group } from '../../components/flex/group';
import AppSidebar from '../app-sidebar';
import UserMenu from './user-menu';
import { QuickSearch } from '../../features/search/quick-search';
import { CONTENT_MAX_WIDTH, CONTENT_PADDING } from './shared';
import { useTheme } from '@emotion/react';
import { IconButton } from '../../components/icon-button';
import { useNavigate } from 'react-router-dom';
import Notifications from './notifications';
import { useAuth } from '../../features/account/useAuth';
import { mediaQueryMinWidth } from '../../hooks/useMediaQuery';

const StyledHeader = styled.header`
  width: 100%;
  height: 60px;
  z-index: 1;
  border-radius: ${({ theme }) => theme.border_radius.base};
  background: ${({ theme }) => theme.colors.background_sub};
  width: 100%;
`;

const StyledHeaderContent = styled.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  height: 100%;
  margin: 0 auto;
  max-width: ${CONTENT_MAX_WIDTH};
  padding: ${CONTENT_PADDING};
`;

const HeaderSection = styled.div<{
  hideOnMobile?: boolean;
}>`
  display: ${({ hideOnMobile }) => (hideOnMobile ? 'none' : 'flex')};

  ${mediaQueryMinWidth.md} {
    display: flex;
  }
`;

const HomeLink = () => {
  const { colors } = useTheme();
  const navigate = useNavigate();
  return (
    <IconButton title="Music Taste" onClick={() => navigate('/')}>
      <svg
        width="36"
        height="36"
        viewBox="0 0 1080 1080"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g clipPath="url(#clip0_176_2)">
          <path
            d="M416.953 420.086C382.969 454.07 365.977 495.086 365.977 543.133C365.977 591.18 382.969 632.195 416.953 666.18C450.938 700.164 491.953 717.156 540 717.156C588.047 717.156 629.062 700.164 663.047 666.18C697.031 632.195 714.023 591.18 714.023 543.133C714.023 495.086 697.031 454.07 663.047 420.086C629.062 386.102 588.047 369.109 540 369.109C491.953 369.109 450.938 386.102 416.953 420.086ZM350.596 623.113C339.756 597.625 334.336 570.965 334.336 543.133C334.336 515.301 339.756 488.787 350.596 463.592C361.436 438.104 376.084 416.131 394.541 397.674C412.998 379.217 434.824 364.568 460.02 353.729C485.508 342.889 512.168 337.469 540 337.469C567.832 337.469 594.346 342.889 619.541 353.729C645.029 364.568 667.002 379.217 685.459 397.674C703.916 416.131 718.564 438.104 729.404 463.592C740.244 488.787 745.664 515.301 745.664 543.133C745.664 570.965 740.244 597.625 729.404 623.113C718.564 648.309 703.916 670.135 685.459 688.592C667.002 707.049 645.029 721.697 619.541 732.537C594.346 743.377 567.832 748.797 540 748.797C512.168 748.797 485.508 743.377 460.02 732.537C434.824 721.697 412.998 707.049 394.541 688.592C376.084 670.135 361.436 648.309 350.596 623.113ZM334.336 424.041C313.242 460.369 302.695 500.066 302.695 543.133C302.695 586.199 313.242 625.896 334.336 662.225C355.723 698.553 384.58 727.41 420.908 748.797C457.236 769.891 496.934 780.438 540 780.438C583.066 780.438 622.764 769.891 659.092 748.797C695.42 727.41 724.131 698.553 745.225 662.225C766.611 625.896 777.305 586.199 777.305 543.133C777.305 500.066 766.611 460.369 745.225 424.041C724.131 387.713 695.42 359.002 659.092 337.908C622.764 316.521 583.066 305.828 540 305.828C496.934 305.828 457.236 316.521 420.908 337.908C384.58 359.002 355.723 387.713 334.336 424.041ZM307.09 678.045C283.066 636.736 271.055 591.766 271.055 543.133C271.055 494.5 283.066 449.529 307.09 408.221C331.113 366.912 363.779 334.246 405.088 310.223C446.396 286.199 491.367 274.188 540 274.188C588.633 274.188 633.604 286.199 674.912 310.223C716.221 334.246 748.887 366.912 772.91 408.221C796.934 449.529 808.945 494.5 808.945 543.133C808.945 591.766 796.934 636.736 772.91 678.045C748.887 719.354 716.221 752.02 674.912 776.043C633.604 800.066 588.633 812.078 540 812.078C491.367 812.078 446.396 800.066 405.088 776.043C363.779 752.02 331.113 719.354 307.09 678.045ZM263.145 426.238C247.324 463.445 239.414 502.41 239.414 543.133C239.414 583.855 247.324 622.82 263.145 660.027C278.965 697.234 300.205 729.314 326.865 756.268C353.818 782.928 385.898 804.168 423.105 819.988C460.312 835.809 499.277 843.719 540 843.719C580.723 843.719 619.688 835.809 656.895 819.988C694.102 804.168 726.035 782.928 752.695 756.268C779.648 729.314 801.035 697.234 816.855 660.027C832.676 622.82 840.586 583.855 840.586 543.133C840.586 502.41 832.676 463.445 816.855 426.238C801.035 389.031 779.648 357.098 752.695 330.438C726.035 303.484 694.102 282.098 656.895 266.277C619.688 250.457 580.723 242.547 540 242.547C499.277 242.547 460.312 250.457 423.105 266.277C385.898 282.098 353.818 303.484 326.865 330.438C300.205 357.098 278.965 389.031 263.145 426.238ZM252.158 709.686C222.568 658.709 207.773 603.191 207.773 543.133C207.773 483.074 222.568 427.557 252.158 376.58C282.041 325.604 322.471 285.32 373.447 255.73C424.424 225.848 479.941 210.906 540 210.906C600.059 210.906 655.576 225.848 706.553 255.73C757.529 285.32 797.812 325.604 827.402 376.58C857.285 427.557 872.227 483.074 872.227 543.133C872.227 603.191 857.285 658.709 827.402 709.686C797.812 760.662 757.529 801.092 706.553 830.975C655.576 860.564 600.059 875.359 540 875.359C479.941 875.359 424.424 860.564 373.447 830.975C322.471 801.092 282.041 760.662 252.158 709.686ZM204.697 402.068C185.654 446.893 176.133 493.914 176.133 543.133C176.133 592.352 185.654 639.52 204.697 684.637C224.033 729.461 249.961 768.133 282.48 800.652C315 833.172 353.672 859.1 398.496 878.436C443.613 897.479 490.781 907 540 907C589.219 907 636.24 897.479 681.064 878.436C726.182 859.1 765 833.172 797.52 800.652C830.039 768.133 855.82 729.461 874.863 684.637C894.199 639.52 903.867 592.352 903.867 543.133C903.867 493.914 894.199 446.893 874.863 402.068C855.82 356.951 830.039 318.133 797.52 285.613C765 253.094 726.182 227.312 681.064 208.27C636.24 188.934 589.219 179.266 540 179.266C490.781 179.266 443.613 188.934 398.496 208.27C353.672 227.312 315 253.094 282.48 285.613C249.961 318.133 224.033 356.951 204.697 402.068ZM175.693 696.941C154.893 648.016 144.492 596.746 144.492 543.133C144.492 489.52 154.893 438.396 175.693 389.764C196.787 340.838 224.912 298.797 260.068 263.641C295.518 228.191 337.559 200.066 386.191 179.266C435.117 158.172 486.387 147.625 540 147.625C593.613 147.625 644.736 158.172 693.369 179.266C742.295 200.066 784.336 228.191 819.492 263.641C854.941 298.797 883.066 340.838 903.867 389.764C924.961 438.396 935.508 489.52 935.508 543.133C935.508 596.746 924.961 648.016 903.867 696.941C883.066 745.574 854.941 787.615 819.492 823.064C784.336 858.221 742.295 886.199 693.369 907C644.736 928.094 593.613 938.641 540 938.641C486.387 938.641 435.117 928.094 386.191 907C337.559 886.199 295.518 858.221 260.068 823.064C224.912 787.615 196.787 745.574 175.693 696.941Z"
            fill={colors.highlight}
          />
        </g>
        <defs>
          <clipPath id="clip0_176_2">
            <rect width="1080" height="1080" fill="white" />
          </clipPath>
        </defs>
      </svg>
    </IconButton>
  );
};

const AppHeader = memo(function AppHeaderFu() {
  const { isLoading, me } = useAuth();
  const [searchActive, setSearchActive] = useState(false);

  return (
    <div
      css={{
        height: '100%',
        maxWidth: '100%',
        width: CONTENT_MAX_WIDTH,
        padding: CONTENT_PADDING,
        margin: '0 auto',
        paddingTop: '8px',
        position: 'sticky',
        top: 0,
        zIndex: 1,
      }}
    >
      <StyledHeader>
        <StyledHeaderContent>
          <HeaderSection hideOnMobile={searchActive}>
            <Group gap="sm">
              <HomeLink />
              <AppSidebar />
            </Group>
          </HeaderSection>
          <QuickSearch onActiveChange={(active) => setSearchActive(active)} />
          <HeaderSection hideOnMobile={searchActive}>
            <Group gap="sm">
              {isLoading ? null : me ? <Notifications /> : null}
              <UserMenu />
            </Group>
          </HeaderSection>
        </StyledHeaderContent>
      </StyledHeader>
    </div>
  );
});

export default AppHeader;
